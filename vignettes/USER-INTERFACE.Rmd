---
title: "How to use Cancer Simulator"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to use Cancer Simulator}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning=FALSE, message=FALSE,
  comment = "#>"
)
```

```{r setup}
devtools::install_github("dinhngockhanh/CancerSimulator")


library(ggplot2)
library(signals)
library(dendextend)
library(fishplot)

library(CancerSimulator)

devtools::load_all()
devtools::document()
```

# Set up model variables
Cancer Simulator requires several csv files containing variables to set up the simulations. Here we detail how to easily build these files.

Let's give a name to the model.

```{r}
MODEL                               <- 'EXPERIMENT-1'
```

## General variables for every cell
The first step is to specify the variables describing every cell during the process. The cells are assumed to have the same expected lifespan (regardless of their driver or CN profiles). The cell lifespan is always in days.

```{r}
cell_lifespan                       <- 7
```

Next, we specify the times at the beginning and the end of the simulation. The unit can be `day`, `week`, `month` or `year`.

```{r}
T_0                                 <- list(1,'year')
T_end                               <- list(10,'year')
```

We use the tau-leaping algorithm to simulate the clonal evolution. This requires a time step. The smaller this step is, the closer the resulting simulation is to the traditional Gillespie's algorithm, but it also means increasing runtime. By default, we use tau = 3 days.

```{r}
T_tau_step                          <- 3
```

An important variable is the size of CN bins. By default, this will be 500,000 bp.

```{r}
CN_bin_length                       <- 500000
```

We have to set up the probability that each class of CN events occurs in a cell division. The local events (chromosome, chromosome-arm or focal level), if happening, will occur on a random location among eligible places.

```{r}
prob_CN_whole_genome_duplication    <- 1e-6
prob_CN_missegregation              <- 1e-6
prob_CN_chrom_arm_missegregation    <- 1e-6
prob_CN_focal_amplification         <- 1e-6
prob_CN_focal_deletion              <- 1e-6
prob_CN_cnloh_interstitial          <- 1e-6
prob_CN_cnloh_terminal              <- 1e-6
```

The focal and CNLOH events require the geometric parameters for the length (in bin count) of the DNA region being affected.

```{r}
prob_CN_focal_amplification_length  <- 0.1
prob_CN_focal_deletion_length       <- 0.1
prob_CN_cnloh_interstitial_length   <- 0.1
prob_CN_cnloh_terminal_length       <- 0.1
```

Next, we set up the mutation rates for drivers and passengers, per bp per cell division.

```{r}
rate_driver                         <- 1e-16
rate_passenger                      <- 1e-11
```






```{r}
BUILD_simulator_variables_from_scratch(model_name=MODEL,
                          cell_lifespan=cell_lifespan,
                          T_0=T_0,
                          T_end=T_end,
                          T_tau_step=T_tau_step,
                          CN_bin_length=CN_bin_length,
                          prob_CN_whole_genome_duplication=prob_CN_whole_genome_duplication,
                          prob_CN_missegregation=prob_CN_missegregation,
                          prob_CN_chrom_arm_missegregation=prob_CN_chrom_arm_missegregation,
                          prob_CN_focal_amplification=prob_CN_focal_amplification,
                          prob_CN_focal_deletion=prob_CN_focal_deletion,
                          prob_CN_cnloh_interstitial=prob_CN_cnloh_interstitial,
                          prob_CN_cnloh_terminal=prob_CN_cnloh_terminal,
                          prob_CN_focal_amplification_length=prob_CN_focal_amplification_length,
                          prob_CN_focal_deletion_length=prob_CN_focal_deletion_length,
                          prob_CN_cnloh_interstitial_length=prob_CN_cnloh_interstitial_length,
                          prob_CN_cnloh_terminal_length=prob_CN_cnloh_terminal_length,
                          rate_driver=rate_driver,
                          rate_passenger=rate_passenger)
```
