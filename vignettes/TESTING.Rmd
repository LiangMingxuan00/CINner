```{r setup}
devtools::install_github("dinhngockhanh/CancerSimulator")


library(ggplot2)
library(signals)
library(CancerSimulator)

devtools::load_all()
devtools::document()
```

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% MIXTURE EXPERIMENT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

```{r}
for(i in 1:100){
      
print('================================================================================   PART A')
MODEL                         <- 'MIXTURE-A'
stage_final                   <- 3
package_output_A              <- SIMULATOR_FULL_PROGRAM_one_simulation(MODEL,stage_final)
print('================================================================================   PREPARE INITIAL STATE FOR EXPERIMENTS B AND C')
MODEL_NEW                     <- 'MIXTURE-B'
EXTRA_build_model_variables_from_sample(MODEL_NEW,package_output_A)
MODEL_NEW                     <- 'MIXTURE-C'
EXTRA_build_model_variables_from_sample(MODEL_NEW,package_output_A)
print('================================================================================   PART B')
MODEL                         <- 'MIXTURE-B'
stage_final                   <- 3
package_output_B              <- SIMULATOR_FULL_PROGRAM_one_simulation(MODEL,stage_final)
print('================================================================================   PART C')
MODEL                         <- 'MIXTURE-C'
stage_final                   <- 3
package_output_B              <- SIMULATOR_FULL_PROGRAM_one_simulation(MODEL,stage_final)

}
```



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% NEUTRAL FALLOPIAN TUBES - ONE SIMULATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

```{r}
MODEL                         <- 'FALLOPIAN-TUBES-NEUTRAL'
stage_final                   <- 3

package_output                <- SIMULATOR_FULL_PROGRAM_one_simulation(MODEL,stage_final)
package_sample                <- package_output[[2]]
sample_genotype_profiles      <- package_sample[[1]]

head(sample_genotype_profiles)

package_sample_phylogeny      <- package_output[[3]]
phylogeny_clustering_truth    <- package_sample_phylogeny[[1]]

plotHeatmap(sample_genotype_profiles,plotcol="state",clusters=phylogeny_clustering_truth$clustering,tree=phylogeny_clustering_truth$tree,reorderclusters=TRUE,plottree=TRUE)

plotHeatmap(sample_genotype_profiles,plotcol="Min",clusters=phylogeny_clustering_truth$clustering,tree=phylogeny_clustering_truth$tree,reorderclusters=TRUE,plottree=TRUE)
```

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% NEUTRAL FALLOPIAN TUBES - MANY SIMULATIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

```{r}
MODEL                         <- 'FALLOPIAN-TUBES-NEUTRAL'
stage_final                   <- 1
N_simulations                 <- 100
SIMULATOR_FULL_PROGRAM_many_simulations(MODEL,stage_final,N_simulations)
```

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% SELECTION OF BULK HGSOC - ONE SIMULATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

```{r}
MODEL <- 'HGSOC-BULK'
SIMULATOR_VARIABLES_for_simulation(MODEL)

parameter_set                                         <- list()
parameter_set$vec_selection_rates                     <- rep(0.05,nrow(driver_library))
parameter_set$rate_driver                             <- 1e-16
parameter_set$prob_CN_whole_genome_duplication        <- 1e-6
parameter_set$prob_CN_missegregation                  <- 1e-6
parameter_set$prob_CN_chrom_arm_missegregation        <- 1e-6
parameter_set$prob_CN_focal_amplification             <- 1e-6
parameter_set$prob_CN_focal_deletion                  <- 1e-6
parameter_set$prob_CN_cnloh_interstitial              <- 1e-6
parameter_set$prob_CN_cnloh_terminal                  <- 1e-6
parameter_set$prob_CN_focal_amplification_length      <- 0.1
parameter_set$prob_CN_focal_deletion_length           <- 0.1
parameter_set$prob_CN_cnloh_interstitial_length       <- 0.1
parameter_set$prob_CN_cnloh_terminal_length           <- 0.1

ABC_one_simulation(MODEL,parameter_set)
```

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% SELECTION OF BULK HGSOC - MANY SIMULATIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

```{r}
MODEL <- 'HGSOC-BULK'
SIMULATOR_VARIABLES_for_simulation(MODEL)

parameter_set                                         <- list()
parameter_set$vec_selection_rates                     <- rep(0.05,nrow(driver_library))
parameter_set$rate_driver                             <- 1e-16
parameter_set$prob_CN_whole_genome_duplication        <- 1e-6
parameter_set$prob_CN_missegregation                  <- 1e-6
parameter_set$prob_CN_chrom_arm_missegregation        <- 1e-6
parameter_set$prob_CN_focal_amplification             <- 1e-6
parameter_set$prob_CN_focal_deletion                  <- 1e-6
parameter_set$prob_CN_cnloh_interstitial              <- 1e-6
parameter_set$prob_CN_cnloh_terminal                  <- 1e-6
parameter_set$prob_CN_focal_amplification_length      <- 0.1
parameter_set$prob_CN_focal_deletion_length           <- 0.1
parameter_set$prob_CN_cnloh_interstitial_length       <- 0.1
parameter_set$prob_CN_cnloh_terminal_length           <- 0.1

N_simulations                                         <- 100

ABC_many_simulations(MODEL,parameter_set,N_simulations)
```
